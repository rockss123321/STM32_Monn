<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bonch-ATS Monitoring</title>
<style>
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        background-color: #1c1c1c;
        color: #fff;
        display: flex;
    }

    nav {
        width: 200px;
        background-color: #111;
        display: flex;
        flex-direction: column;
        padding-top: 20px;
        box-shadow: 2px 0 5px rgba(0,0,0,0.5);
    }

    nav a {
        padding: 15px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
        margin-bottom: 5px;
        border-left: 4px solid transparent;
        transition: all 0.2s;
    }

    nav a:hover {
        background-color: #333;
        border-left: 4px solid #ff9900;
    }

    nav a.active {
        background-color: #222;
        border-left: 4px solid #ff9900;
    }

    main {
        flex: 1;
        padding: 20px 30px;
    }

    header {
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 20px;
        color: #ff9900;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 18px;
        background-color: #2c2c2c;
        border-radius: 12px;
        overflow: hidden;
    }

    th, td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid #444;
    }

    th {
        background-color: #333;
        font-weight: 600;
        color: #ff9900;
    }

    tr:last-child td {
        border-bottom: none;
    }

    .ok { background-color: #ff9900; color: #000; }
    .warning { background-color: #555; color: #fff; }
    .error { background-color: #000; color: #fff; }
</style>
</head>
<body>
    <nav>
        <a href="#" class="active">Главная123123</a>
        <a href="event.html">Журнал</a>
        <a href="settings.html">Настройки</a>
        <a href="update.html">Обновление ПО</a>
    </nav>

    <main>
        <header>
            Bonch-ATS Monitoring
            <span id="datetime"><!--#datetime--></span>
        </header>
        <div id="table-id">
            <!-- Таблица будет подгружаться сюда -->
        </div>
    </main>

<script>
async function updateTable() {
    const table_div = document.getElementById("table-id");
    const datetime_span = document.getElementById("datetime");
    try {
        const resp = await fetch('/table.shtml', {cache: "no-store"});
        const data = await resp.text();

        const scrollPosition = window.scrollY;
        table_div.innerHTML = data;
        window.scrollTo(0, scrollPosition);

        // Обновляем дату/время
        const datetimeMatch = data.match(/<!--#datetime-->(.*?)<\/td>/s);
        if(datetimeMatch && datetime_span) {
            datetime_span.textContent = datetimeMatch[1].trim();
        }

        // Закругление углов
        const tables = table_div.getElementsByTagName('table');
        for (let table of tables) {
            const rows = table.getElementsByTagName('tr');
            for (let row of rows) {
                if (row.cells.length > 0) {
                    row.cells[0].style.borderTopLeftRadius = '8px';
                    row.cells[0].style.borderBottomLeftRadius = '8px';
                    const lastCell = row.cells[row.cells.length - 1];
                    lastCell.style.borderTopRightRadius = '8px';
                    lastCell.style.borderBottomRightRadius = '8px';
                }
            }
        }

        // Подсветка строк по напряжению
        const v1 = parseFloat(document.getElementById('v1')?.textContent) || 0;
        const v2 = parseFloat(document.getElementById('v2')?.textContent) || 0;
        const trList = table_div.getElementsByTagName('tr');

        let rowA = trList[1];
        let rowB = trList[2];

        if (v1 > 20 && v2 > 20) {
            rowA.className = 'ok';
            rowB.className = 'warning';
        } else if (v1 > 20 && v2 <= 20) {
            rowA.className = 'ok';
            rowB.className = 'error';
        } else if (v1 <= 20 && v2 > 20) {
            rowA.className = 'error';
            rowB.className = 'ok';
        } else {
            rowA.className = 'error';
            rowB.className = 'error';
        }

    } catch (err) {
        console.error('Ошибка загрузки таблицы:', err);
        table_div.innerHTML = '<p style="color:red;">Не удалось загрузить данные</p>';
    }
}

// Обновление каждые 2 секунды
updateTable();
setInterval(updateTable, 2000);
</script>
</body>
</html>
