<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bonch-ATS Monitoring — Журнал</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <nav>
    <a href="index.html">Главная</a>
    <a href="#" class="active">Журнал</a>
    <a href="settings.html">Настройки</a>
    <a href="update.html">Обновление ПО</a>

  </nav>

  <main>
    <header>Bonch-ATS Monitoring — Журнал</header>
    <div id="table-id">
      <!-- Таблица журнала будет подгружаться сюда -->
    </div>
  </main>

  <script>
    async function updateTable() {
      const table_div = document.getElementById("table-id");
      try {
        const resp = await fetch('/event.shtml');
        const data = await resp.text();

        const scrollPosition = window.scrollY;
        table_div.innerHTML = data;
        window.scrollTo(0, scrollPosition);

        // Закругление углов
        const tables = table_div.getElementsByTagName('table');
        for (let table of tables) {
          const rows = table.getElementsByTagName('tr');
          for (let row of rows) {
            if (row.cells.length > 0) {
              row.cells[0].style.borderTopLeftRadius = '8px';
              row.cells[0].style.borderBottomLeftRadius = '8px';
              const lastCell = row.cells[row.cells.length - 1];
              lastCell.style.borderTopRightRadius = '8px';
              lastCell.style.borderBottomRightRadius = '8px';
            }
          }
        }

        // Для журнала можно добавить подсветку по необходимости,
        // например, строки с событием ERROR -> .error, WARNING -> .warning, INFO -> .ok
        const rows = table_div.getElementsByTagName('tr');
        for (let i = 1; i < rows.length; i++) {
          const text = rows[i].textContent.toLowerCase();
          if (text.includes('error')) {
            rows[i].className = 'error';
          } else if (text.includes('warning')) {
            rows[i].className = 'warning';
          } else {
            rows[i].className = 'ok';
          }
        }

      } catch (err) {
        console.error('Ошибка загрузки журнала:', err);
        table_div.innerHTML = '<p style="color:red;">Не удалось загрузить данные журнала</p>';
      }
    }

    // Обновление каждые 5 секунд
    updateTable();
    setInterval(updateTable, 5000);
  </script>
</body>

</html>